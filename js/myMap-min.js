$(function(){var e=L.map("map");var t={"高德地图":L.tileLayer("http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",{subdomains:"1234"}).addTo(e),"高德影像":L.layerGroup([L.tileLayer("http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",{subdomains:"1234"}),L.tileLayer("http://t{s}.tianditu.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}",{subdomains:"1234"})])};L.tileLayer("https://a.tiles.mapbox.com/v3/foursquare.map-0y1jh28j/{z}/{x}/{y}.png",{attribution:'Map &copy; Pacific Rim Coordination Center (PRCC).  Certain data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',key:"BC9A493B41014CAABB98F0471D759707",styleId:22677});var a=L.control.layers(t,{},{position:"topleft"}).addTo(e);e.setView(L.latLng(37.550339,104.114129),4);var o=new L.echartsLayer3(e,echarts);var r=o.getEchartsContainer();var n=o.initECharts(r);var i={"上海":[121.4453,31.2234],"齐齐哈尔":[123.9179,47.3543],"洮南":[122.7863,45.3355],"山海关":[119.76,40.0109],"喜峰口":[118.3552,40.4173],"承德市":[117.9634,40.9515],"呼和浩特":[111.7519,40.8414],"卢沟桥":[116.2251,39.8514],"台儿庄":[117.3219,34.8107],"兰考县":[114.8211,34.8223],"德安县":[115.756,29.3134],"广东":[113.2662,23.1317],"南昌":[115.8579,28.682],"随县":[113.2999,31.8538],"钦州":[108.6492,21.9379],"枣阳":[112.7739,32.1283],"宜昌":[111.2864,30.6918],"光山县":[114.9187,32.0099],"上高县":[114.9248,28.2333],"衡阳":[112.5719,26.8932],"桂林":[110.29,25.2736],"巴达布朗族哈尼族乡":[100.0589,21.8551],"缅甸北部":[99.8382,21.7748],"缅甸密支那":[97.1081,25.1104],"腾冲":[98.4909,25.0205],"新野县":[112.3626,32.5074],"襄阳":[112.1813,31.9428],"怀化":[110.017,27.3717],"龙州县":[106.8545,22.3426],"南丹县":[107.5422,24.9753],"全州县":[111.073,25.9286],"南阳":[112.546,32.9735],"贵阳":[106.6755,26.6183],"韶关":[113.5742,24.8141],"东莞":[113.8953,22.901],"东营":[118.7073,37.5513],"中山":[113.4229,22.478],"临汾":[111.4783,36.1615],"临沂":[118.3118,35.2936],"丹东":[124.541,40.4242],"丽水":[119.5642,28.1854],"乌鲁木齐":[87.9236,43.5883],"佛山":[112.8955,23.1097],"保定":[115.0488,39.0948],"兰州":[103.5901,36.3043],"包头":[110.3467,41.4899],"北京":[116.3974,39.9088],"北海":[109.314,21.6211],"南京":[118.8062,31.9208],"南宁":[108.479,23.1152],"南昌":[116.0046,28.6633],"南通":[121.1023,32.1625],"厦门":[118.1689,24.6478],"台州":[121.1353,28.6688],"合肥":[117.29,32.0581],"呼和浩特":[111.4124,40.4901],"咸阳":[108.4131,34.8706],"哈尔滨":[127.9688,45.368],"唐山":[118.4766,39.6826],"嘉兴":[120.9155,30.6354],"大同":[113.7854,39.8035],"大连":[122.2229,39.4409],"天津":[117.4219,39.4189],"太原":[112.3352,37.9413],"常德":[111.6985,29.0315],"宁波":[121.5967,29.6466],"宝鸡":[107.1826,34.3433],"宿迁":[118.5535,33.7775],"常州":[119.4543,31.5582],"广州":[113.5107,23.2196],"廊坊":[116.521,39.0509],"延安":[109.1052,36.4252],"张家口":[115.1477,40.8527],"徐州":[117.5208,34.3268],"德州":[116.6858,37.2107],"惠州":[114.6204,23.1647],"成都":[103.9526,30.7617],"扬州":[119.4653,32.8162],"承德":[117.5757,41.4075],"昆明":[102.9199,25.4663],"杭州":[119.5313,29.8773],"枣庄":[117.323,34.8926],"柳州":[109.3799,24.9774],"株洲":[113.5327,27.0319],"武汉":[114.3896,30.6628],"汕头":[117.1692,23.3405],"江门":[112.6318,22.1484],"沈阳":[123.1238,42.1216],"沧州":[116.8286,38.2104],"淮安":[118.927,33.4039],"温州":[120.498,27.8119],"玉溪":[101.9312,23.8898],"珠海":[113.7305,22.1155],"盐城":[120.2234,33.5577],"石家庄":[114.4995,38.1006],"福州":[119.4543,25.9222],"长沙":[112.9388,28.2277],"绍兴":[120.5643,29.7565],"舟山":[122.2559,30.2234],"苏州":[120.6519,31.3989],"衡水":[115.8838,37.7161],"衢州":[118.6853,28.8666],"西宁":[101.4038,36.8207],"西安":[109.1162,34.2004],"贵阳":[106.6992,26.7682],"邢台":[114.8071,37.2821],"邯郸":[114.4775,36.535],"郑州":[113.4668,34.6234],"韶关":[113.7964,24.7028],"运城":[111.0069,35.0262],"衡阳":[112.5719,26.8932],"东京湾":[139.7815,35.4414]};var l="arrow";var s=function(e){var t=[];for(var a=0;a<e.length;a++){var o=e[a];var r=i[o[0].name];var n=i[o[1].name];if(r&&n){t.push([{coord:r},{coord:n}])}}return t};var p=["#C81610","#ffa022","#46bee9"];var f=[];var c={China:"./img/China.png",peace:"./img/peace.png",Japanese:"./img/Japanese.png"};var h=[];var m={name:""};var d={name:"",value:""};var y=[];var u=[];var x=[];for(var v=0;v<jsonData.length-1;v++){x=[];u=[];var g=jsonData[v].site;var b=jsonData[v+1].site;if($.isArray(g)){for(var w=0;w<g.length;w++){if($.isArray(b)){for(var S=0;S<b.length;S++){y=[];m={};d={};m["name"]=g[w];d["name"]=b[S];d["value"]=90;y.push(m);y.push(d);u.push(y)}}else{y=[];m={};d={};m["name"]=g[w];d["name"]=b;d["value"]=90;y.push(m);y.push(d);u.push(y)}}}else{if($.isArray(b)){for(var S=0;S<b.length;S++){y=[];m={};d={};m["name"]=g;d["name"]=b[S];d["value"]=90;y.push(m);y.push(d);u.push(y)}}else{y=[];m={};d={};m["name"]=g;d["name"]=b;d["value"]=90;y.push(m);y.push(d);u.push(y)}}x.push(g);x.push(u);h.push(x)}h.unshift(["东京湾",[[{name:"东京湾"},{name:"齐齐哈尔",value:90}]]]);var j=[["东京湾",[[{name:"东京湾"},{name:"齐齐哈尔",value:90}]]]];for(var C=0;C<jsonData.length;C++){var D=jsonData[C].content;for(var A=0;A<D.length;A++){if(A>0&&A/25==0){D[A]=D[A]+"\n"}}}j.forEach(function(e,t){f.push()});option={baseOption:{timeline:{axisType:"category",orient:"vertical",autoPlay:true,inverse:true,playInterval:2500,left:null,right:20,top:20,bottom:20,width:55,height:null,label:{normal:{textStyle:{color:"#999"}},emphasis:{textStyle:{color:"#fff"}}},symbol:"none",lineStyle:{color:"#555"},checkpointStyle:{color:"#bbb",borderColor:"#777",borderWidth:2},controlStyle:{showNextBtn:false,showPrevBtn:false,normal:{color:"#666",borderColor:"#666"},emphasis:{color:"#aaa",borderColor:"#aaa"}},data:[]},title:[],grid:[{x2:"7%",y:"65%",width:"18%",height:"18%"},{x2:"7%",y:"15%",width:"18%",height:"18%"}],calculable:true,xAxis:[{gridIndex:0,type:"category",data:["中国胜 ","平","日本胜"]},{gridIndex:1,type:"category",data:["中国","日本"]}],yAxis:[{gridIndex:0,minInterval:1,type:"value"},{gridIndex:1,minInterval:1,type:"value"}],label:[{normal:{show:true,position:"inside",color:"#000"}},{normal:{show:true,position:"inside",color:"#000"}}],barWidth:20,tooltip:{trigger:"item"},geo:{map:"",label:{emphasis:{show:true}},width:200,height:400,roam:true,itemStyle:{normal:{areaColor:"#323c48",borderColor:"#404a59"},emphasis:{areaColor:"#2a333d"}}},legend:[{orient:"vertical",right:500,top:600,data:["中国胜","平","日本胜"]},{orient:"horizontal",right:100,top:80,data:["总兵力","伤亡数量"]}],series:[]},options:[]};for(var z=0;z<jsonData.length;z++){option.baseOption.timeline.data.push(jsonData[z].startTime);option.options.push({title:[{textAlign:"center",text:"中国"+"   "+"平"+"   "+"日本",left:"83%",top:"55%",textStyle:{fontFamily:"KaiTi",fontSize:30,color:"#3239ff"}},{textAlign:"center",left:"83%",top:"60%",textStyle:{fontFamily:"KaiTi",fontSize:30,color:"#FF243B"},show:true,text:jsonData[z].china+"     "+jsonData[z].peace+"     "+jsonData[z].Japanese},{textAlign:"center",left:"50%",top:"15%",textStyle:{fontSize:30,color:"#000000"},show:true,text:"胜方"+":"+jsonData[z].winner+""},{textAlign:"center",left:"50%",top:"5%",show:true,textStyle:{fontFamily:"KaiTi",fontSize:50,color:"rgba(255, 2, 2, 0.8)"},text:jsonData[z].warname+""},{left:"5%",top:"7%",width:300,show:true,textStyle:{fontSize:15,fontFamily:"KaiTi",color:"rgba(34, 85, 255, 0.8)"},text:jsonData[z].content+""},{left:"16%",top:"3%",width:300,show:true,textStyle:{fontSize:15,fontFamily:"KaiTi",color:"rgba(0, 0, 0, 0.8)"},text:"战争简介"+""},{left:"15%",top:"80%",width:300,show:true,textStyle:{fontSize:90,color:"rgba(0, 0, 0, 0.6)"},text:jsonData[z].startTime+""}],series:[{name:h[z][0]+" ",type:"lines",zlevel:1,effect:{show:true,period:1,trailLength:.7,color:"#ff243b",symbolSize:3},lineStyle:{normal:{color:p[0],width:0,curveness:.2}},data:s(h[z][1])},{name:h[z][0]+"",type:"lines",zlevel:2,effect:{show:true,period:6,trailLength:0,symbol:l,symbolSize:15},lineStyle:{normal:{color:p[0],width:1,opacity:.4,curveness:.2}},data:s(h[z][1])},{name:jsonData[z].warname,type:"effectScatter",coordinateSystem:"geo",zlevel:2,rippleEffect:{brushType:"stroke"},label:{normal:{show:true,position:"right",formatter:"{b}"}},symbolSize:function(e){return e[2]/8},itemStyle:{normal:{color:p[0]}},data:h[z][1].map(function(e){return{name:e[1].name,value:i[e[1].name].concat([e[1].value])}})},{name:"中国胜",type:"bar",xAxisIndex:0,yAxisIndex:0,data:[jsonData[z].china,0,0],itemStyle:{normal:{barBorderRadius:[5,0,0,5],color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#f696aa"},{offset:.5,color:"#f0505f"},{offset:1,color:"#f00a10"}])}}},{name:"平",type:"bar",xAxisIndex:0,yAxisIndex:0,data:[0,jsonData[z].peace,0],itemStyle:{normal:{barBorderRadius:[5,0,0,5],color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#c4f68b"},{offset:.5,color:"#8ff075"},{offset:1,color:"#09f02f"}])}}},{name:"日本胜",type:"bar",xAxisIndex:0,yAxisIndex:0,data:[0,0,jsonData[z].Japanese],itemStyle:{normal:{barBorderRadius:[5,0,0,5],color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#afb5eb"},{offset:.5,color:"#726aff"},{offset:1,color:"#221eff"}])}}},{name:"总兵力",type:"bar",xAxisIndex:1,yAxisIndex:1,data:[jsonData[z].ChinaCount,jsonData[z].JapCount],itemStyle:{normal:{barBorderRadius:[5,0,0,5],color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#9abaf6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])}}},{name:"伤亡数量",type:"bar",xAxisIndex:1,yAxisIndex:1,data:[jsonData[z].ChinaLosses,jsonData[z].JapLosses],itemStyle:{normal:{barBorderRadius:[5,0,0,5],color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#f696aa"},{offset:.5,color:"#f0505f"},{offset:1,color:"#f00a10"}])}}}]})}$("#map").hide();$("#open").click(function(){$("#open").animate({width:"200%",opacity:0},3e3,function(){$("#open").hide();$("#map").fadeIn(800);n.setOption(option,true)})})});